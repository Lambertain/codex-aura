# generated by datamodel-codegen:
#   filename:  graph.schema.json
#   timestamp: 2025-12-05T13:12:43+00:00

from __future__ import annotations

from datetime import datetime
from typing import Dict, List, Optional

from pydantic import BaseModel, Field, confloat, conint, constr

from . import edge, node


class BlameInfo(BaseModel):
    primary_author: str = Field(..., description='Primary author of the file')
    contributors: List[str] = Field(
        ..., description='List of all contributors to the file'
    )
    author_distribution: Dict[constr(regex=r'.*'), conint(ge=0)] = Field(
        ...,
        description='Distribution of authorship across the file (author -> line count)',
    )


class Repository(BaseModel):
    path: str = Field(..., description='Absolute path to the repository root')
    name: str = Field(..., description='Name of the repository (basename of the path)')


class Stats(BaseModel):
    total_nodes: conint(ge=0) = Field(
        ..., description='Total number of nodes in the graph'
    )
    total_edges: conint(ge=0) = Field(
        ..., description='Total number of edges in the graph'
    )
    node_types: Dict[constr(regex=r'.*'), conint(ge=0)] = Field(
        ..., description='Count of nodes by type (file, class, function)'
    )
    average_complexity: Optional[confloat(ge=0.0)] = Field(
        None, description='Average complexity score across all nodes'
    )
    hot_spots_count: Optional[conint(ge=0)] = Field(
        None, description='Number of high-complexity or high-connectivity nodes'
    )


class Graph(BaseModel):
    version: str = Field(..., description='Version of the graph format')
    generated_at: datetime = Field(
        ..., description='Timestamp when the graph was generated (ISO 8601)'
    )
    repository: Repository = Field(
        ..., description='Information about the analyzed repository'
    )
    stats: Stats = Field(..., description='Statistics about the graph contents')
    nodes: List[node.Schema] = Field(..., description='List of all nodes in the graph')
    edges: List[edge.Schema] = Field(..., description='List of all edges in the graph')
    sha: Optional[str] = Field(
        None, description='Current commit SHA of the analyzed repository'
    )
